# -*- coding: utf-8 -*-
"""
/***************************************************************************
 QSEQUOIA2DockWidget
                                 A QGIS plugin
 simplifions le qutodien des forestiers
 Generated by Plugin Builder: http://g-sherman.github.io/Qgis-Plugin-Builder/
                             -------------------
        begin                : 2026-01-07
        git sha              : $Format:%H$
        copyright            : (C) 2026 by Alexandre Le Bars - SequoiAPP
        email                : alexlb329@gmail.com
 ***************************************************************************/

/***************************************************************************
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 ***************************************************************************/
"""

import os

from qgis.PyQt import QtGui, QtWidgets, uic
from PyQt5.QtWidgets import QWidget
from qgis.PyQt.QtCore import pyqtSignal
from qgis.PyQt.QtWidgets import QFileDialog
from qgis.PyQt.QtWidgets import QTreeWidgetItem
from PyQt5.QtGui import QIcon

from qsequoia2.scripts.forest_settings.forest_settings_dialog import Ui_ForestSettingsDialog
from qsequoia2.scripts.project_settings.project_settings_dialog import Ui_ProjectSettingsDialog
from qsequoia2.scripts.WMS_settings.WMS_settings_dialog import Ui_WMSSettingsDialog

FORM_CLASS, _ = uic.loadUiType(os.path.join(
    os.path.dirname(__file__), 'QSEQUOIA2_dockwidget_base.ui'))


class QSEQUOIA2DockWidget(QtWidgets.QDockWidget, FORM_CLASS):

    closingPlugin = pyqtSignal()

    def __init__(self, parent=None):
        """Constructor."""
        super(QSEQUOIA2DockWidget, self).__init__(parent)
        # Set up the user interface from Designer.
        # After setupUI you can access any designer object by doing
        # self.<objectname>, and you can use autoconnect slots - see
        # http://doc.qt.io/qt-5/designer-using-a-ui-file.html
        # #widgets-and-dialogs-with-auto-connect
        self.setupUi(self)
        self.populate_functions_tree()

        # chemin vers ton logo
        plugin_dir = os.path.dirname(__file__)
        logo_path = os.path.join(plugin_dir, "icon.png")

        # d√©finit l‚Äôic√¥ne du dockwidget
        self.setWindowIcon(QIcon(logo_path))


        # Cr√©er les widgets pour les onglets existants
        #self.tools_tab = QWidget()
        #self.tools_ui = Ui_QSEQUOIA2DockWidget()
        #self.tools_ui.setupUi(self.tools_tab)

        project_settings_tab = QWidget()
        self.project_settings_ui = Ui_ProjectSettingsDialog()
        self.project_settings_ui.setupUi(project_settings_tab)

        forest_settings_tab = QWidget()
        self.forest_settings_ui = Ui_ForestSettingsDialog()
        self.forest_settings_ui.setupUi(forest_settings_tab)

        WMS_settings_tab = QWidget()
        self.WMS_settings_ui = Ui_WMSSettingsDialog()
        self.WMS_settings_ui.setupUi(WMS_settings_tab)


        # Ajouter les onglets + icons au QTabWidget

        plugin_path = os.path.dirname(__file__)
        #self.tabWidget.addTab(self.tools_tab, QIcon(plugin_path + "/icons/tools_settings.svg"),"")
        self.tabWidget.setTabToolTip(0, "Outils et fonctions")
        self.tabWidget.addTab(project_settings_tab, QIcon(plugin_path + "/icons/project_settings.svg"),"")
        self.tabWidget.setTabToolTip(1, "Param√®tres du projet")
        self.tabWidget.addTab(forest_settings_tab, QIcon(plugin_path + "/icons/forest_settings.svg"),"")
        self.tabWidget.setTabToolTip(2, "Param√®tres forestiers")
        self.tabWidget.addTab(WMS_settings_tab, QIcon(plugin_path + "/icons/WMS_settings.svg"),"")
        self.tabWidget.setTabToolTip(3, "Param√®tres WMS")





    def populate_functions_tree(self):
        tree = self.functionsLibrary
        tree.clear()

        # =========================
        # Traitements bureautique
        # =========================
        bureautique = QTreeWidgetItem(tree)
        bureautique.setText(0, "Gestion de projets")

        data = [
            ("üìù Cr√©ation dossier SIG",
             "Mise en forme du fichier excel issue du traitement UA vers SSPF"),
            ("‚úíÔ∏è Rangement final des couches",
             "Exporte les couches du projet courant en gpkg avec leurs styles")


        ]
        
        for label, tooltip in data:
            item = QTreeWidgetItem(bureautique)
            item.setText(0, label)
            item.setToolTip(0, tooltip)

        # =========================
        # Cr√©ation cartographique
        # =========================
        utils = QTreeWidgetItem(tree)
        utils.setText(0, "Utilitaire python")

        data = [
            ("üå≥Create Qfield project from PARCA or UA",
             "Cr√©e un projet Qfield depuis le projet"),

            ("üîßClassification des relev√©es",
             "Classe les relev√©es selon des param√®tres d√©finis"),

            ("üñ•Qfield vers excel et UA",
             "Mise au propre des relev√©s r√©alis√© sur le terrain vers un excel et un UA complet"),

            ("üìëClasser les ame_type",
             "Sort un excel de stat de la couche"),

            ("üéÑAjouter la r√©g√©",
             "Ajoute la r√©g√© depuis la couche terrain_point"),

            ("0Ô∏è‚É£ Retirer les 0",
             "retire les 0 de sortie sur la couche SSPF et PARFOR"),

            ("üÜóRemplacer le nom des champs",
             "Remplace le nom d'un champ"),

            ("üìèsymbologie finale",
             "ajoute les couches TSE_point, STR_point avec le style"),

            ("üì•Data IGN",
             "T√©l√©chargement de donn√©es IGN"),

            ("üß≥Reprojection d'un vecteur",
             "Reprojection d'un vecteur selon un autre CRS"),

            ("üìèD√©t√©ction de la hauteur dominante",
             "dans une couche, √† partir d'un LIDAR, d√©t√©ction des hauteurs dominantes depuis un MNH")
            

        ]

        for label, tooltip in data:
            item = QTreeWidgetItem(utils)
            item.setText(0, label)
            item.setToolTip(0, tooltip)

        # =========================
        # Outils g√©n√©raux
        # =========================

        net = QTreeWidgetItem(tree)
        net.setText(0, "Outils en ligne")

        data = [
            ("üîßKartenn-IA",
             "Page de l'IA foresti√®re Kartenn"),
        
            ("üîßCarto-futaie", 
             "Page de Carto-Futaie"),

            ("üîßSequoiAPP",
             "Ouvre la page internet de SequoiAPP")
        ]

        for label, tooltip in data:
            item = QTreeWidgetItem(net)
            item.setText(0, label)
            item.setToolTip(0, tooltip)



        tree.expandAll()


    def closeEvent(self, event):
        self.closingPlugin.emit()
        event.accept()

    


